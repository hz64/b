<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>小米QCN基带下载</title>
<meta name="description" content="提供小米QCN基带文件的下载，包括文件名、发布日期、文件大小和MD5校验码。">
<meta name="keywords" content="小米,QCN,基带,下载,zeusQCN,Xiaomi_Mi5s,y3-">
<meta name="robots" content="index, follow">

<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-200 font-sans min-h-screen flex flex-col items-center p-4">

<h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-4 text-center">小米QCN基带下载</h1>

<input type="text" id="search-input" placeholder="搜索文件名..." 
    class="w-full max-w-md mb-6 px-4 py-2 rounded-md shadow-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">

<div class="hidden md:block w-full overflow-x-auto bg-white shadow-md rounded-md">
    <table class="min-w-full border-collapse">
        <thead class="bg-gray-700 text-white">
            <tr>
                <th class="px-4 py-2 text-left text-sm sm:text-xs font-medium uppercase tracking-wider">文件名</th>
                <th class="px-4 py-2 text-left text-sm sm:text-xs font-medium uppercase tracking-wider">发布日期</th>
                <th class="px-4 py-2 text-left text-sm sm:text-xs font-medium uppercase tracking-wider">文件大小</th>
                <th class="px-4 py-2 text-left text-sm sm:text-xs font-medium uppercase tracking-wider">MD5 Hash</th>
                <th class="px-4 py-2 text-left text-sm sm:text-xs font-medium uppercase tracking-wider">下载链接</th>
            </tr>
        </thead>
        <tbody id="rss-table-body-desktop" class="bg-white divide-y divide-gray-200">
            <tr><td colspan="5" class="text-center py-4 text-gray-500">正在加载数据...</td></tr>
        </tbody>
    </table>
</div>

<div id="rss-card-container" class="md:hidden w-full flex flex-col gap-4">
    <div class="text-center py-4 text-gray-500">正在加载数据...</div>
</div>

<script>
const ORIGINAL_RSS_URL = 'https://sourceforge.net/projects/hz64/rss?path=/qcn';
const PROXY_URL = 'https://corsproxy.io/?';
const RSS_URL = PROXY_URL + encodeURIComponent(ORIGINAL_RSS_URL);

const desktopTbody = document.getElementById("rss-table-body-desktop");
const cardContainer = document.getElementById("rss-card-container");
const searchInput = document.getElementById("search-input");

let rssItems = [];

function formatBytes(bytes, decimals = 2) {
    if (!bytes || isNaN(bytes)) return 'N/A';
    const k = 1024, dm = decimals < 0 ? 0 : decimals;
    const sizes = ['Bytes','KB','MB','GB','TB'];
    const i = Math.floor(Math.log(bytes)/Math.log(k));
    return parseFloat((bytes/Math.pow(k,i)).toFixed(dm)) + ' ' + sizes[i];
}

function renderRss(items) {
    desktopTbody.innerHTML = '';
    if (!items.length) {
        desktopTbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">没有找到文件。</td></tr>';
    } else {
        items.forEach(item => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td class="px-4 py-2 text-sm sm:text-xs font-medium text-gray-900">${item.title}</td>
                <td class="px-4 py-2 text-sm sm:text-xs text-gray-500">${item.pubDate.toLocaleDateString()}</td>
                <td class="px-4 py-2 text-sm sm:text-xs text-gray-500">${formatBytes(item.filesize)}</td>
                <td class="px-4 py-2 text-sm sm:text-xs text-gray-500">${item.md5Hash}</td>
                <td class="px-4 py-2 text-sm sm:text-xs font-medium">
                    <a href="${item.link}" class="text-indigo-600 hover:text-indigo-900" target="_blank" rel="noopener noreferrer">下载</a>
                </td>
            `;
            desktopTbody.appendChild(row);
        });
    }

    cardContainer.innerHTML = '';
    if (!items.length) {
        cardContainer.innerHTML = '<div class="text-center py-4 text-gray-500">没有找到文件。</div>';
    } else {
        items.forEach(item => {
            const card = document.createElement("div");
            card.className = "bg-white shadow-md rounded-md p-4 flex flex-col gap-2";
            card.innerHTML = `
                <div class="font-semibold text-gray-900">${item.title}</div>
                <div class="text-gray-500 text-sm">发布日期: ${item.pubDate.toLocaleDateString()}</div>
                <div class="text-gray-500 text-sm">文件大小: ${formatBytes(item.filesize)}</div>
                <div class="text-gray-500 text-sm">MD5: ${item.md5Hash}</div>
                <a href="${item.link}" class="text-indigo-600 hover:text-indigo-900 font-medium" target="_blank" rel="noopener noreferrer">下载</a>
            `;
            cardContainer.appendChild(card);
        });
    }
}

async function fetchAndParseRss() {
    desktopTbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">正在加载数据...</td></tr>';
    cardContainer.innerHTML = '<div class="text-center py-4 text-gray-500">正在加载数据...</div>';
    try {
        const response = await fetch(RSS_URL);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const xmlText = await response.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, "application/xml");
        const errorNode = xmlDoc.querySelector('parsererror');
        if (errorNode) throw new Error("解析 RSS 数据失败");

        const items = xmlDoc.getElementsByTagName("item");
        rssItems = [];

        for (let i=0;i<items.length;i++){
            const item = items[i];
            const title = item.getElementsByTagName("title")[0]?.textContent.replace("/qcn/","") || "N/A";
            const link = item.getElementsByTagName("link")[0]?.textContent || "#";
            const pubDateStr = item.getElementsByTagName("pubDate")[0]?.textContent;
            const pubDate = pubDateStr ? new Date(pubDateStr) : new Date();

            let filesize = 0, md5Hash = "无";
            const mediaContent = item.getElementsByTagNameNS("http://video.search.yahoo.com/mrss/","content")[0];
            if(mediaContent){
                const fs = mediaContent.getAttribute("filesize");
                filesize = fs && !isNaN(parseInt(fs)) ? parseInt(fs) : 0;
                const md5El = mediaContent.getElementsByTagNameNS("http://video.search.yahoo.com/mrss/","hash")[0];
                if(md5El && md5El.textContent && md5El.textContent !== "None") md5Hash = md5El.textContent;
            }

            rssItems.push({title, link, pubDate, filesize, md5Hash});
        }

        renderRss(rssItems);

    } catch (error) {
        desktopTbody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-red-500">加载数据时发生错误: ${error.message}</td></tr>`;
        cardContainer.innerHTML = `<div class="text-center py-4 text-red-500">加载数据时发生错误: ${error.message}</div>`;
    }
}

searchInput.addEventListener('input', () => {
    const keyword = searchInput.value.trim().toLowerCase();
    const filtered = rssItems.filter(item => item.title.toLowerCase().includes(keyword));
    renderRss(filtered);
});

window.onload = fetchAndParseRss;
</script>
</body>
</html>
